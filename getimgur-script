#!/usr/bin/Rscript --no-restore --no-save 


args <- commandArgs(trailingOnly = TRUE)

library(XML)
library(RCurl)

destdir <- "YOUR FILE PATH HERE"

getimgurURL<- function(url, appended = "", destdir) {
  preparse <- htmlTreeParse(url, useInternalNodes = TRUE)
  # Parse out images waiting to be shown in preview gallery 
  # Some galleries use different containers
  if (xpathApply(preparse, "//body//div[@id='content']", xmlAttrs)[[1]][2] %in% "outside album") container <- "//body//img[@class='unloaded thumb-title-embed']"
  else container <- "//body//img[@class='unloaded thumb-title']"
  # Grab image urls
  thumbs.uri <- unlist(lapply(xpathApply(preparse, container, xmlAttrs), function(x) getElement(x, grep("^data-src", names(x)))))
  # Thumbnails on imgur are denoted with a trailing "s" in the filename
  url.final <- sub("s.", ".", thumbs.uri, fixed = TRUE)
  # Album title becomes folder title
  dirtitle <- file.path(destdir,
    					gsub("*(\n)|*(\t)", replacement = "", xpathApply(preparse, "//head//title", xmlValue)[[1]])
  						)
  if (grepl("Photo Album", dirtitle)) dirtitle <- paste(dirtitle, appended, sep = "_")
  if (file.exists(dirtitle)) return(NULL)
  filetitles <- file.path(dirtitle, basename(url.final))
  dir.create(dirtitle)
  file.create(filetitles)
  for (i in seq_along(url.final)) {
  	writeBin(getBinaryURL(url.final[i]), filetitles[i])
  }
}

for (i in 1:length(args)) getimgurURL(url = args[i], appended = i, destdir = destdir)

q()